# 贈る言葉BOT 受け入れ基準

## 概要

このドキュメントは贈る言葉BOT機能の受け入れ基準とテスト項目を記載します。

## 機能テスト基準

**【信頼性レベル凡例】**:
- 🔵 **青信号**: EARS要件定義書・設計文書・ユーザヒアリングを参考にした確実なテスト基準
- 🟡 **黄信号**: EARS要件定義書・設計文書・ユーザヒアリングから妥当な推測によるテスト基準
- 🔴 **赤信号**: EARS要件定義書・設計文書・ユーザヒアリングにない推測によるテスト基準

### F-001: 言葉入力フォーム

#### REQ-001: 「贈りたい言葉」入力欄の表示 🔵 *requirements.md.pdf より*

**Given（前提条件）**:
- トップページにアクセスしている
- ブラウザはモダンブラウザ（Chrome/Firefox/Edge/Safari最新版）

**When（実行条件）**:
- ページが読み込まれた時

**Then（期待結果）**:
- 「贈りたい言葉」というラベルが表示される
- テキスト入力欄（1行）が表示される
- プレースホルダーテキストが表示される（例：「例: ありがとう」）
- 入力欄は空の状態

**テストケース**:
- [x] 正常系: ページ読み込み後、入力欄が表示される
- [x] 正常系: 日本語で入力できる
- [x] 正常系: 英数字も入力できる
- [x] 正常系: 絵文字も入力できる

#### REQ-002: 「その意味」入力欄の表示 🔵 *requirements.md.pdf より*

**Given（前提条件）**:
- トップページにアクセスしている

**When（実行条件）**:
- ページが読み込まれた時

**Then（期待結果）**:
- 「その意味」というラベルが表示される
- テキストエリア（複数行入力欄）が表示される
- プレースホルダーテキストが表示される
- 最低3行程度の高さがある

**テストケース**:
- [x] 正常系: 複数行の入力ができる
- [x] 正常系: 改行が保持される
- [x] 正常系: 長文入力時にスクロールバーが表示される

#### REQ-004: 初回訪問時チュートリアル表示 🔵 *ユーザヒアリング2025-01-20より*

**Given（前提条件）**:
- 初めてサイトを訪問した（Cookieなし）

**When（実行条件）**:
- トップページが読み込まれた時

**Then（期待結果）**:
- チュートリアルモーダルまたはオーバーレイが表示される
- 3ステップ程度の簡潔な説明
- 「スキップ」または「閉じる」ボタンがある
- 「次回から表示しない」チェックボックスがある

**テストケース**:
- [x] 正常系: 初回訪問時にチュートリアルが表示される
- [x] 正常系: 「閉じる」ボタンで閉じられる
- [x] 正常系: 「次回から表示しない」選択後、再訪問時に表示されない
- [x] 異常系: 2回目の訪問時には表示されない

#### REQ-011/012: 空欄バリデーション 🟡 *requirements.md.pdf + ユーザヒアリングより*

**Given（前提条件）**:
- トップページの入力フォームが表示されている

**When（実行条件）**:
- 「贈りたい言葉」または「その意味」が空のまま送信ボタンをクリック

**Then（期待結果）**:
- 空欄の入力欄の下にエラーメッセージが表示される
- エラーメッセージ: 「この項目は必須です」
- 入力欄が赤枠で強調される
- 送信ボタンが無効化される

**テストケース**:
- [x] 異常系: 両方空の場合、両方にエラー表示
- [x] 異常系: 言葉のみ空の場合、言葉のみエラー表示
- [x] 異常系: 意味のみ空の場合、意味のみエラー表示
- [x] 正常系: 両方入力後、エラーメッセージが消える

#### REQ-013: 「贈りたい言葉」文字数制限 🔵 *ユーザヒアリング2025-01-20より*

**Given（前提条件）**:
- 「贈りたい言葉」入力欄にフォーカスがある

**When（実行条件）**:
- 51文字以上を入力した時

**Then（期待結果）**:
- エラーメッセージ: 「50文字以内で入力してください（現在: XX文字）」
- 入力欄が赤枠で強調される
- 送信ボタンが無効化される

**テストケース**:
- [x] 境界値: 49文字 → エラーなし
- [x] 境界値: 50文字 → エラーなし
- [x] 境界値: 51文字 → エラー表示
- [x] 正常系: 文字数カウンターが表示される（オプション）
- [x] 正常系: 削除して50文字以下にするとエラーが消える

#### REQ-014: 「その意味」文字数制限 🔵 *ユーザヒアリング2025-01-20より*

**Given（前提条件）**:
- 「その意味」入力欄にフォーカスがある

**When（実行条件）**:
- 301文字以上を入力した時

**Then（期待結果）**:
- エラーメッセージ: 「300文字以内で入力してください（現在: XXX文字）」
- 入力欄が赤枠で強調される
- 送信ボタンが無効化される

**テストケース**:
- [x] 境界値: 299文字 → エラーなし
- [x] 境界値: 300文字 → エラーなし
- [x] 境界値: 301文字 → エラー表示
- [x] 正常系: 文字数カウンターが表示される（オプション）

### F-002: 共有リンク生成

#### REQ-101/102/103: URL生成 🔵 *requirements.md.pdf、CLAUDE.mdより*

**Given（前提条件）**:
- 両方の入力欄に有効なデータが入力されている
- バリデーションエラーがない

**When（実行条件）**:
- 送信ボタンをクリックした時

**Then（期待結果）**:
- 一意のURLが生成される
- URLはBase64エンコードされている
- URLパラメータまたはハッシュフラグメントに入力内容が含まれる
- URLが画面に表示される
- URLコピーボタンが表示される

**テストケース**:
- [x] 正常系: 同じ入力でも異なる時刻なら異なるURL（オプション）
- [x] 正常系: 生成されたURLにアクセスすると入力内容が表示される
- [x] 正常系: 日本語が正しくエンコードされる
- [x] 正常系: 絵文字が正しくエンコードされる

#### REQ-104/105: URLコピー機能 🔵 *ユーザヒアリング2025-01-20より*

**Given（前提条件）**:
- 共有URLが生成されて表示されている

**When（実行条件）**:
- 「コピー」ボタンをクリックした時

**Then（期待結果）**:
- URLがクリップボードにコピーされる
- トーストメッセージ「URLをコピーしました」が表示される
- トーストは3秒程度で自動的に消える

**テストケース**:
- [x] 正常系: コピーボタンクリック後、クリップボードにURLが入る
- [x] 正常系: トーストメッセージが表示される
- [x] 正常系: トーストが自動的に消える
- [x] 異常系: クリップボードAPIが使えない場合、URL選択状態になる

#### REQ-111: URL長さ制限 🔵 *ユーザヒアリング2025-01-20より*

**Given（前提条件）**:
- 入力内容が長い（言葉50文字+意味300文字）

**When（実行条件）**:
- URL生成を試みた時

**Then（期待結果）**:
- 生成されるURL全体が500文字以内
- 500文字を超える場合はエラーメッセージ表示（稀なケース）

**テストケース**:
- [x] 境界値: 最大入力（50+300文字）でURL長さを確認
- [x] 正常系: URL長さが500文字以内に収まる
- [x] 異常系: 万が一超える場合、適切なエラーメッセージ

### F-003: 贈る言葉表示ページ

#### REQ-201/202: 背景画像表示 🔵 *requirements.md.pdf 第2.3章より*

**Given（前提条件）**:
- 有効な共有URLにアクセスした

**When（実行条件）**:
- 表示ページが読み込まれた時

**Then（期待結果）**:
- 武田鉄矢の画像（武田鉄矢.png）が背景として表示される
- 画像は右側〜中央に配置される
- 画像が歪まずに表示される
- レスポンシブに対応している

**テストケース**:
- [x] 正常系: PC画面で適切に表示される
- [x] 正常系: スマートフォン横向きで適切に表示される
- [x] 正常系: タブレットで適切に表示される
- [x] 異常系: 画像読み込み失敗時、代替表示またはエラー

#### REQ-203/204: 縦書きテキスト表示 🔵 *requirements.md.pdf 第2.3章より*

**Given（前提条件）**:
- 表示ページが読み込まれた

**When（実行条件）**:
- タイプライターアニメーション完了後

**Then（期待結果）**:
- テキストが縦書きで表示される（CSS `writing-mode: vertical-rl`）
- 黒板の左側スペースに配置される
- 辞書風のデザイン（見出し語+意味）
- チョーク風の色（`#f0f0f0`または`#fffacd`）

**テストケース**:
- [x] 正常系: 縦書きが正しく表示される
- [x] 正常系: ひらがな、カタカナ、漢字が正しく表示される
- [x] 正常系: 半透明背景で可読性が確保される（オプション）
- [x] 正常系: フォントが適切（Noto Serif JPなど）

#### REQ-205/231: タイプライターアニメーション 🔵 *requirements.md.pdf、ユーザヒアリングより*

**Given（前提条件）**:
- 表示ページが読み込まれた直後

**When（実行条件）**:
- ページ表示開始

**Then（期待結果）**:
- 1文字ずつ順番に表示される
- 表示速度は100ms/文字
- アニメーションはスムーズ（60fps）
- 言葉→意味の順に表示される

**テストケース**:
- [x] 正常系: 1文字ずつ表示される
- [x] 正常系: 表示速度が適切（速すぎず遅すぎず）
- [x] 正常系: アニメーションがカクつかない
- [x] 正常系: 全文表示完了後に停止する

#### REQ-221: アニメーションスキップ（オプション）🔵 *ユーザヒアリング2025-01-20より*

**Given（前提条件）**:
- タイプライターアニメーション表示中

**When（実行条件）**:
- 画面をクリック/タップした時

**Then（期待結果）**:
- アニメーションが即座に完了する
- 全文が一度に表示される
- スキップ可能であることがUIで示される（オプション）

**テストケース**:
- [x] 正常系: クリックでスキップできる
- [x] 正常系: タップでスキップできる
- [x] 正常系: スキップ後も表示が崩れない

#### REQ-206: トップページへのナビゲーション 🔵 *ユーザヒアリング2025-01-20より*

**Given（前提条件）**:
- 表示ページが表示されている

**When（実行条件）**:
- 「新しい言葉を贈る」ボタンをクリックした時

**Then（期待結果）**:
- トップページ（入力フォーム）に遷移する
- 入力欄は空の状態
- スムーズに遷移する

**テストケース**:
- [x] 正常系: ボタンクリックでトップに戻る
- [x] 正常系: 新規作成として入力欄がクリアされる

#### REQ-211/212/213: エラーハンドリング 🟡 *一般的なエラーハンドリングより*

**Given（前提条件）**:
- 不正なURLにアクセスした

**When（実行条件）**:
- URLパラメータが不正/存在しない

**Then（期待結果）**:
- エラーページまたはエラーメッセージが表示される
- トップページへ戻るリンクが表示される
- エラー内容が分かりやすい

**テストケース**:
- [x] 異常系: パラメータなしでアクセス → トップへリダイレクト
- [x] 異常系: 不正なBase64 → エラーメッセージ表示
- [x] 異常系: デコード失敗 → 分かりやすいエラー表示

### F-004: 画像ダウンロード

#### REQ-301/302/303: 画像保存機能 🔵 *requirements.md.pdf、CLAUDE.mdより*

**Given（前提条件）**:
- 表示ページが完全に表示されている
- タイプライターアニメーション完了

**When（実行条件）**:
- 「画像を保存」ボタンをクリックした時

**Then（期待結果）**:
- html2canvasでページが画像化される
- PNG形式で画像がダウンロードされる
- ファイル名: `gift-words-YYYYMMDD.png`
- 武田鉄矢の画像と言葉が一緒に保存される

**テストケース**:
- [x] 正常系: クリックで画像がダウンロードされる
- [x] 正常系: ファイル形式がPNG
- [x] 正常系: 画質が標準（鮮明）
- [x] 正常系: 縦書きテキストが正しく画像化される
- [x] 正常系: 武田鉄矢の画像が含まれる

#### REQ-304/305: 画像品質 🔵 *ユーザヒアリング2025-01-20より*

**Given（前提条件）**:
- 画像保存が実行された

**When（実行条件）**:
- 保存された画像を開いた時

**Then（期待結果）**:
- 標準画質で保存されている
- 文字が読みやすい
- 画像サイズが適切（大きすぎず小さすぎず）

**テストケース**:
- [x] 正常系: 文字が鮮明に読める
- [x] 正常系: 画像が粗くない
- [x] 正常系: ファイルサイズが妥当（1MB前後）

#### REQ-311: 画像生成エラーハンドリング 🔵 *ユーザヒアリング エラー通知より*

**Given（前提条件）**:
- 画像保存ボタンをクリックした

**When（実行条件）**:
- html2canvasが失敗した場合

**Then（期待結果）**:
- トーストメッセージでエラー通知
- エラーメッセージ: 「画像の保存に失敗しました。もう一度お試しください。」

**テストケース**:
- [x] 異常系: 画像生成失敗時にエラー通知
- [x] 異常系: ブラウザ非対応時に警告表示

## 非機能テスト基準

### パフォーマンステスト

#### NFR-001: ページ読み込み時間 🔵 *requirements.md.pdf、tech-stack.mdより*

**テスト環境**:
- ネットワーク: 標準的な4G/Wi-Fi
- デバイス: 一般的なスマートフォン・PC

**合格基準**:
- 初回読み込み: 3秒以内
- 2回目以降（キャッシュあり）: 1秒以内

**テストケース**:
- [x] トップページ読み込み時間測定
- [x] 表示ページ読み込み時間測定
- [x] 画像（武田鉄矢.png）読み込み時間測定
- [x] JavaScript読み込み・実行時間測定

**テスト方法**:
- Chrome DevTools Networkタブで計測
- Lighthouse Performance測定

#### NFR-002: アニメーションフレームレート 🔵 *tech-stack.mdより*

**合格基準**:
- タイプライターアニメーション: 60fps以上
- フレーム落ちなし

**テストケース**:
- [x] アニメーション中のFPS測定
- [x] 長文（300文字）でもスムーズに動作

**テスト方法**:
- Chrome DevTools Performance録画
- FPS Meterで確認

#### NFR-003: バンドルサイズ 🔵 *tech-stack.mdより*

**合格基準**:
- 総バンドルサイズ: 500KB以下（gzip圧縮後）
- JavaScript: 300KB以下
- CSS: 50KB以下

**テストケース**:
- [x] `npm run build`後のファイルサイズ確認
- [x] gzip圧縮後のサイズ測定

**テスト方法**:
- Vite build分析
- webpack-bundle-analyzer（使用する場合）

#### NFR-004: Lighthouseスコア 🔵 *tech-stack.mdより*

**合格基準**:
- Performance: 90点以上
- Accessibility: 85点以上（基本対応）
- Best Practices: 90点以上
- SEO: 90点以上

**テストケース**:
- [x] トップページのLighthouse測定
- [x] 表示ページのLighthouse測定

**テスト方法**:
- Chrome DevTools Lighthouse
- 本番環境URLで測定

### セキュリティテスト

#### NFR-101/102/103: XSS対策 🔵 *tech-stack.mdより*

**テストシナリオ**:
- 悪意のあるスクリプトを入力欄に入力

**テストケース**:
- [x] `<script>alert('XSS')</script>` をエスケープして表示
- [x] `<img src=x onerror=alert('XSS')>` をエスケープ
- [x] `dangerouslySetInnerHTML`を使用していないことを確認
- [x] ユーザー入力がサニタイズされている

**合格基準**:
- すべての入力がエスケープされ、スクリプト実行されない
- Reactのデフォルトエスケープが正しく機能

#### NFR-104: URLパラメータセキュリティ 🔵 *tech-stack.mdより*

**テストケース**:
- [x] URLパラメータがBase64エンコードされている
- [x] デコード時にエラーハンドリングが適切
- [x] 不正なパラメータを拒否する

**合格基準**:
- 基本的な難読化が機能
- 不正入力で例外が発生しない

### ユーザビリティテスト

#### NFR-201/202: 操作の簡単さ 🔵 *requirements.md.pdfより*

**テストシナリオ**:
- 初めて使うユーザーが言葉を作成して共有するまで

**合格基準**:
- 操作ステップ: 3ステップ以内
- 所要時間: 3分以内（初回）、1分以内（2回目以降）

**テストケース**:
- [x] 操作ステップ数を数える
- [x] ユーザビリティテスト（5名程度）で平均時間測定
- [x] 迷う箇所の特定

#### NFR-203: レスポンシブデザイン 🔵 *requirements.md.pdf、ユーザヒアリングより*

**テストデバイス**:
- スマートフォン: iPhone 12/13, Pixel 6
- タブレット: iPad Air
- PC: 1920x1080, 1366x768

**テストケース**:
- [x] スマートフォン縦向き: 適切に表示
- [x] スマートフォン横向き: PC版と同じレイアウト
- [x] タブレット: 適切に表示
- [x] PC各解像度: 適切に表示

**合格基準**:
- すべてのデバイスで機能が使える
- テキストが読みやすい
- ボタンがタップ/クリックしやすい

#### NFR-204/205/206: アクセシビリティ 🔵 *tech-stack.md、ユーザヒアリングより*

**テストケース**:
- [x] セマンティックHTML使用確認
- [x] `<button>`、`<input>`、`<label>`が適切
- [x] ARIA属性が必要箇所に適用
- [x] キーボードのみで操作可能（Tab、Enter、Escapeキー）
- [x] フォーカスインジケータが見やすい

**テスト方法**:
- axe DevToolsでアクセシビリティチェック
- キーボードのみで全機能を操作
- スクリーンリーダー（オプション）

**合格基準**:
- axe DevToolsエラー0件
- 全機能がキーボード操作可能

### ブラウザ互換性テスト

#### NFR-301: ブラウザ対応 🔵 *requirements.md.pdfより*

**テスト対象ブラウザ**:
- Chrome 最新版
- Firefox 最新版
- Edge 最新版
- Safari 最新版（macOS/iOS）

**テストケース**:
- [x] 各ブラウザで全機能が動作
- [x] レイアウト崩れがない
- [x] アニメーションが正常動作
- [x] 画像保存機能が動作

**合格基準**:
- すべての対象ブラウザで問題なく動作

## Edgeケーステスト基準

### EDGE-001: ネットワークエラー 🟡 *エラーハンドリング要件より*

**テストシナリオ**:
- ネットワーク接続が不安定な状況
- オフライン状態

**テストケース**:
- [x] オフライン時にページアクセス → エラーメッセージ
- [x] 画像読み込み失敗 → 代替表示またはエラー
- [x] エラーメッセージが分かりやすい

**合格基準**:
- ユーザーに適切なエラー通知
- システムがクラッシュしない

### EDGE-002: 古いブラウザ 🟡 *一般的なブラウザ互換性より*

**テストシナリオ**:
- IE11などの古いブラウザでアクセス

**テストケース**:
- [x] html2canvas非対応 → 警告メッセージ
- [x] ES6非対応 → ポリフィルまたは警告
- [x] 基本機能は動作（入力、共有）

**合格基準**:
- 致命的なエラーが発生しない
- 適切な警告・代替案の提示

### EDGE-003: クリップボードAPI非対応 🟡 *一般的なAPI対応より*

**テストシナリオ**:
- クリップボードAPIが使えない環境

**テストケース**:
- [x] コピーボタンクリック → URL選択状態
- [x] 手動コピーを促すメッセージ表示

**合格基準**:
- 代替手段でコピー可能

### EDGE-101〜106: 境界値テスト 🔵 *ユーザヒアリング バリデーション要件より*

**テストケース詳細**:

| テストID | 入力値 | 期待結果 |
|---------|--------|---------|
| EDGE-101 | 言葉: 0文字 | エラー: 「この項目は必須です」 |
| EDGE-102 | 言葉: 50文字 | 正常動作 |
| EDGE-103 | 言葉: 51文字 | エラー: 「50文字以内で入力してください」 |
| EDGE-104 | 意味: 0文字 | エラー: 「この項目は必須です」 |
| EDGE-105 | 意味: 300文字 | 正常動作 |
| EDGE-106 | 意味: 301文字 | エラー: 「300文字以内で入力してください」 |

**合格基準**:
- すべての境界値で正しく動作

### EDGE-201: 絵文字入力 🟡 *日本語対応要件より*

**テストケース**:
- [x] 言葉に絵文字（😊👍🎉）を入力 → 正常表示
- [x] 意味に絵文字を入力 → 正常表示
- [x] URL生成時にエンコードエラーなし
- [x] 表示ページで正しく表示

**合格基準**:
- 絵文字が入力・表示・保存できる

### EDGE-202: 改行入力 🟡 *複数行入力要件より*

**テストケース**:
- [x] 意味欄に改行を含む入力 → 改行が保持される
- [x] URL生成時にエンコードエラーなし
- [x] 表示ページで改行が正しく表示

**合格基準**:
- 改行が入力・表示・保存で保持される

## 統合テスト基準

### 全体フローテスト

**シナリオ1: 基本的な利用フロー（エンドツーエンド）**

1. トップページにアクセス
2. チュートリアルを見る/スキップ
3. 「贈りたい言葉」に「ありがとう」を入力
4. 「その意味」に「いつも支えてくれてありがとう」を入力
5. 送信ボタンをクリック
6. 生成されたURLをコピー
7. 新しいタブで生成URLにアクセス
8. タイプライターアニメーションを見る
9. 画像として保存
10. 「新しい言葉を贈る」ボタンでトップに戻る

**合格基準**:
- 全ステップが問題なく完了する
- 所要時間: 3分以内

**シナリオ2: バリデーションエラー対応フロー**

1. トップページにアクセス
2. 何も入力せず送信 → エラー表示
3. 言葉のみ入力して送信 → エラー表示
4. 意味も入力して送信 → 成功

**合格基準**:
- すべてのバリデーションが正しく機能

**シナリオ3: モバイルでの利用フロー**

1. スマートフォンでトップページにアクセス
2. 言葉と意味を入力
3. URLを生成してLINEに送信（模擬）
4. 受信側でURLをタップして表示
5. 画像として保存

**合格基準**:
- モバイルで全機能が使える
- タッチ操作がスムーズ

## 受け入れテスト実行チェックリスト

### テスト実行前

- [ ] テスト環境の準備完了（ローカル・ステージング）
- [ ] テストデータの準備完了
- [ ] テストツールの準備完了
  - [ ] Chrome DevTools
  - [ ] Lighthouse
  - [ ] axe DevTools
- [ ] 実行担当者の確認完了
- [ ] テストスケジュール確認

### テスト実行中

- [ ] 全機能テストの実行（F-001〜F-004）
- [ ] 全非機能テストの実行（NFR-001〜NFR-401）
- [ ] Edgeケーステストの実行（EDGE-001〜EDGE-202）
- [ ] 統合テストの実行（シナリオ1〜3）
- [ ] 問題発見時の記録（スクリーンショット、再現手順）
- [ ] 修正後の再テスト

### テスト完了後

- [ ] テスト結果の記録
- [ ] 残存問題の整理
  - [ ] Critical: 0件
  - [ ] High: 0件
  - [ ] Medium: 管理可能な範囲
  - [ ] Low: 次バージョン対応可
- [ ] 受け入れ可否の判定
- [ ] ステークホルダーへの報告

### リリース判定基準

**Must（必須）:**
- [ ] すべてのMust Have機能が動作
- [ ] Criticalバグ0件
- [ ] Highバグ0件
- [ ] パフォーマンステスト合格
- [ ] セキュリティテスト合格
- [ ] 主要ブラウザ（Chrome, Safari）で動作確認

**Should（推奨）:**
- [ ] すべてのShould Have機能が動作
- [ ] Mediumバグ3件以下
- [ ] Lighthouseスコア目標達成
- [ ] 全ブラウザで動作確認

**Could（あれば良い）:**
- [ ] Could Have機能の動作確認
- [ ] Lowバグ対応

## 更新履歴

- 2025-01-20: 初回作成（/tsumiki:kairo-requirementsにより生成）
